export const DENAH = [
  // DEPAN 1 ATAS
  ["2111","A215","14487574247","DEPAN 1 (4)"], ["2109","A211","14487590508","DEPAN 1 (3)"], ["2107","A209","14487574296","DEPAN 1 (3)"], ["2108","A206","14487589526","DEPAN 1 (2)"], 
  ["2102","A202","14486215032","DEPAN 1 (2)"], ["3112","A312","14486480537","DEPAN 1 (2)"], ["3109","A309","14486612899","DEPAN 1 (1)"], ["3102","A302","14486610398","DEPAN 1 (1)"], 
  // DEPAN 1 BAWAH
  ["2116","A212","14487574254","DEPAN 1 (3)"], ["2112","A210", "14487590953","DEPAN 1 (3)"], ["2106","A206A", "14486214506","DEPAN 1 (3)"], ["2103","A205","14486215016","DEPAN 1 (2)"], 
  ["2101","A201","14486214522","DEPAN 1 (2)"], ["3110","A310", "14486094924","DEPAN 1 (1)"], ["3103","A303", "14486611917","DEPAN 1 (1)"], ["3101","A301", "14486611867","DEPAN 1 (1)"],

  // DEPAN 2 ATAS
  ["3216","B316","14486582662","BELAKANG 3 (2)"], ["3210","B310", "14490968626","BELAKANG 3 (1)"], ["3203","B303","14486481287","BELAKANG 3 (1)"], ["3201","B301","14486290688","BELAKANG 3 (1)"], 
  ["1111","A111","14486478903","DEPAN 1 (5)"], ["1110","A110A","14490962579","DEPAN 1 (5)"], ["1107","A107","14487589161","DEPAN 1 (4)"], ["1102","A102","14487590797","DEPAN 1 (4)"], 
  //DEPAN 2 BAWAH
  ["3212","B312","14490968410","BELAKANG 3 (2)"], ["3209","B309","14486582878","BELAKANG 3 (1)"], ["3202","B302","14485838065","BELAKANG 3 (1)"], ["G101","AG01","14486476733","DEPAN 1 (5)"], 
  ["1112","A110B","14490968501","DEPAN 1 (5)"], ["1109","A109","14486474779","DEPAN 1 (5)"], ["1103","A103","14486613301","DEPAN 1 (4)"], ["1101","A101","86271241761","DEPAN 1 (4)"],

  // DEPAN 3 ATAS
  ["1218","B112","14486291223","BELAKANG 4 (1)"], ["1211","B111","14486291231","BELAKANG 3 (5)"], ["1209","B109","14486290373","BELAKANG 3 (5)"], ["1207","B107","14486279558","BELAKANG 3 (5)"], ["1203","B103","14486570964","BELAKANG 3 (4)"], 
  ["1201","B101","14486582589","BELAKANG 3 (4)"], ["2216","B212","14486584395","BELAKANG 3 (3)"], ["2212","B210","14486574073","BELAKANG 3 (3)"], ["2210","B208","14485837851","BELAKANG 3 (3)"], ["2202","B202A","14486582217","BELAKANG 3 (2)"], 
  // DEPAN 3 BAWAH
  ["G201","BG01","14486290795","BELAKANG 4 (1)"], ["1216","B110","14486290241","BELAKANG 3 (5)"], ["1212","B108","14486290704","BELAKANG 3 (5)"], ["B106A","B106A","14486290290","BELAKANG 3 (4)"], ["1202","B102A","14486570972","BELAKANG 3 (4)"], 
  ["2211","B215","14486570931","BELAKANG 3 (4)"], ["2209","B211","14486586119","BELAKANG 3 (3)"], ["2207","B209","14490958072","BELAKANG 3 (3)"], ["2203","B205","14486478630","BELAKANG 3 (2)"], ["2201","B201","14486583231","BELAKANG 3 (2)"],

  // DEPAN 4 ATAS
  ["3507","D305B","14486474431","BELAKANG 2 (1)"], ["3510","D308B","14486291710","BELAKANG 2 (2)"], ["3506","D306","14490951176","BELAKANG 2 (2)"], ["3502","D302","14487673650","BELAKANG 2 (1)"], ["1302","C102","14490950657","DEPAN 3 (4)"], 
  ["2606","E206","14486587653","BELAKANG 1 (2)"],["3312","C312","14486582290","DEPAN 3 (2)"], ["3309","C309","14486571020","DEPAN 3 (1)"], ["3302","C302","14490957769","DEPAN 3 (1)"],
  // DEPAN 4 BAWAH
  ["3505","D305A","14486588560","BELAKANG 2 (3)"], ["3508","D308A","14486282784","BELAKANG 2 (2)"], ["3503","D303","14490963031","BELAKANG 2 (1)"], ["1303","C103","14486293252","DEPAN 3 (4)"], ["1301","C101","14486571798","DEPAN 3 (4)"], 
  ["3501","D301","14486583371","BELAKANG 2 (1)"], ["3310","C310","14486573141","DEPAN 3 (1)"], ["3303","C303","14486570998","DEPAN 3 (1)"], ["3301","C301","14486290316","DEPAN 3 (1)"],

  // DEPAN 5 ATAS
  ["1309","C107B","14486478549","DEPAN 3 (5)"], ["2305","C205A","14486293179","DEPAN 3 (3)"], ["2302","C202","14486293245","DEPAN 3 (2)"], ["1307","C107A","14486588123","DEPAN 3 (5)"], 
  ["1308","C106B","14486547285","DEPAN 3 (5)"], ["3518","D312","14486291744","BELAKANG 2 (3)"], ["3512","D310A","14486293278","BELAKANG 2 (2)"],
  // DEPAN 5 BAWAH
  ["2307","C205B","14490955524","DEPAN 3 (3)"], ["2303","C203","14490955664","DEPAN 3 (2)"], ["2301","C201","14490950475","DEPAN 3 (2)"], ["3603","E303","14486285274","BELAKANG 1 (1)"], 
  ["3601","E301","14490951143","BELAKANG 1 (1)"], ["3516","D310B","14486283022","BELAKANG 2 (2)"], ["1306","C106A","14489669888","DEPAN 3 (5)"],

  // DEPAN 6 ATAS
  ["2603","E203","14486285803","BELAKANG 1 (2)"], ["2601","E201","14490963122","BELAKANG 1 (1)"], ["1311","C109","14486474092","DEPAN 3 (6)"], ["2511","D207B","14486573687","BELAKANG 2 (4)"], ["2506","D206","14486588107","BELAKANG 2 (4)"], 
  ["2505","D205A","14486474142","BELAKANG 2 (3)"], ["2502","D202","14486474134","BELAKANG 2 (5)"], ["2316","C212","14486586481","DEPAN 3 (4)"], ["2311","C209","14486584478","DEPAN 3 (3)"], ["2308","C208A","14490955730","DEPAN 3 (3)"],
  // DEPAN 6 BAWAH
  ["2602","E202","14486581169","BELAKANG 1 (1)"], ["2512","D212","14486474258","BELAKANG 2 (4)"], ["1312","C108B","14486586390","DEPAN 3 (6)"], ["2509","D207A","14486586499","BELAKANG 2 (4)"], ["2507","D205B","14486476063","BELAKANG 2 (4)"], 
  ["2503","D203","14486589402","BELAKANG 2 (3)"], ["2501","D201","14490950350","BELAKANG 2 (5)"], ["2312","C210","14486293286","DEPAN 3 (4)"], ["2310","C208B","14489674979","DEPAN 3 (3)"], ["1310","C108A","14486285795","DEPAN 3 (5)"],

  // TENGAH 1 ATAS
  ["3306","C306","86261332406","DEPAN 4 (1)"], ["3308","C308","86261307705","DEPAN 4 (1)"], ["3602","E302","86261344120","DEPAN 4 (2)"], ["2306","C206","86261312770","DEPAN 4 (5)"], ["2508","D208","86261341472","DEPAN 4 (2)"], 
  ["2605","E205","86261342298","DEPAN 4 (3)"], ["1509","D107","86261269285","DEPAN 4 (3)"], ["1605","E105","86261313067","DEPAN 4 (4)"], ["G505","D605","86261311640"],
  // TENGAH 1 BAWAH
  ["3305","C305","86261515075","DEPAN 4 (1)"], ["3307","C307","86261292576","DEPAN 4 (2)"], ["3509","D307","86261269194","DEPAN 4 (1)"], ["3605","E305","86261311566","DEPAN 4 (2)"], 
  ["2309","C207","86261312929","DEPAN 4 (2)"], ["2510","D210","86261341746","DEPAN 4 (3)"], ["1305","C105","86261269228","DEPAN 4 (3)"], ["1512","D110","86261269319","DEPAN 4 (3)"],

  // TENGAH 2 ATAS
  ["3106","A306","86261337959","DEPAN 2 (1)"], ["3108","A308","86261312622","DEPAN 2 (1)"], ["2105","A207","86261311533","DEPAN 2 (2)"], ["1105","A105","86261310683","DEPAN 2 (2)"], 
  ["1108","A108","86261307978","DEPAN 2 (2)"], ["3206","B306","86261307762","DEPAN 2 (3)"], ["3208","B308","86261311376","DEPAN 2 (3)"], ["2208","B206","86261312200","DEPAN 2 (4)"], 
  ["1206","B102","86261313042","DEPAN 2 (4)"], ["G508","DG08","86261307820","DEPAN 4 (4)"], ["G108","AG08","86261286693","DEPAN 2 (5)"], ["G208","BG08","86261311301","DEPAN 2 (5)"],
  // TENGAH 2 BAWAH
  ["3105","A305","86261338247","DEPAN 2 (1)"], ["3107","A307","86261343049","DEPAN 2 (1)"], ["G207","BG09","86261340680","DEPAN 2 (1)"], ["2110","A208","86261309099","DEPAN 2 (2)"], 
  ["1106","A106","86261308125","DEPAN 2 (2)"], ["3205","B305","86261311152","DEPAN 2 (3)"], ["3207","B307","86261308653","DEPAN 2 (3)"], ["2206","B202","86261284136","DEPAN 2 (3)"], 
  ["2205","B207","86261312267","DEPAN 2 (4)"], ["1205","B105","86261310840","DEPAN 2 (4)"], ["G106","AG06","86261307457","DEPAN 2 (5)"], ["G206","BG06","86261311723"],

  // BELAKANG 1 ATAS
  ["G305","CG05A","86261308323","DEPAN 4 (5)"], ["G301","CG01","86261309354","DEPAN 3 (6)"], ["1603","E103","86261311517","BELAKANG 1 (2)"], ["1601","E101","86261311293","BELAKANG 1 (2)"], 
  ["1507","D105B","86260687990","BELAKANG 2 (5)"], ["1510","D108B","86261311699"], ["1506","D106","86261311178","BELAKANG 2 (6)"], ["1502","D102","86261299449","BELAKANG 1 (5)"],
  // BELAKANG 1 BAWAH
  ["G307","CG05B","86260688832","DEPAN 4 (5)"], ["G303","CG03","86261309651","DEPAN 4 (5)"], ["1606","E106","86261306418","BELAKANG 1 (2)"], ["1602","E102","86261269053","BELAKANG 1 (6)"],
  ["1516","D112","86261310584","BELAKANG 2 (6)"], ["1505","D105A","86261309487","BELAKANG 2 (5)"], ["1508","D108A","86261284458"], ["1503","D103","86261311053","BELAKANG 1 (5)"], ["1501","D101","86261269343","BELAKANG 2 (5)"],

  // BELAKANG 2 ATAS
  ["G203","BG05","14486611933","BELAKANG 4 (1)"], ["G210","BG10","14486480925","BELAKANG 4 (2)"], ["G212","BG12","14486499834","BELAKANG 4 (2)"], ["G216","BG16","14486535181","BELAKANG 4 (2)"], ["G218","BG18","14486179667","BELAKANG 4 (3)"],
  ["G102","AG02","14486480891","BELAKANG 4 (3)"], ["G107","AG07","14487652852","BELAKANG 4 (4)"], ["G111","AG11","14487662919","BELAKANG 4 (4)"], ["G110","AG10A","14487673924","BELAKANG 4 (4)"], ["1210","B108A","14486612824"], 
  ["1208","B106","14487647563","DEPAN 2 (4)"], ["1316","C110","14487674559","DEPAN 3 (6)"], ["G603","EG03","14486184642","BELAKANG 1 (5)"], ["G601","EG01","14489675984","BELAKANG 1 (4)"], ["G512","DG10B","14490951200","BELAKANG 1 (4)"], 
  ["G509","DG07B","86261270291","BELAKANG 1 (4)"], ["G506","DG06","86261311087","BELAKANG 1 (3)"], ["G502","DG02","86260688121","BELAKANG 1 (3)"], ["G318","CG12","86261270028","BELAKANG 2 (6)"], ["G311","CG09","86261310485","DEPAN 4 (6)"], 
  ["G310","CG08A","86261285208","DEPAN 4 (6)"], ["G306","CG06A","86261306582","DEPAN 4 (5)"],
  //BELAKANG 2 BAWAH
  ["G202","BG02","14486610380","BELAKANG 4 (1)"], ["G205", "BG07","14486534507","BELAKANG 4 (1)"], ["G209","BG11","14486480479","BELAKANG 4 (2)"], ["G211","BG15","14486480917","BELAKANG 4 (2)"], ["G215","BG17","14486536239","BELAKANG 4 (3)"],
  ["G103","AG03","14486480610","BELAKANG 4 (3)"], ["G105","AG05","14487674609","BELAKANG 4 (3)"], ["G109","AG09","14490965861","BELAKANG 4 (4)"], ["G115","AG15","14486612857","BELAKANG 4 (4)"], ["G112","AG10B","14487650047","BELAKANG 4 (5)"],
  ["1318","C112","14487630809","DEPAN 3 (6)"], ["G302","CG02","14487674047","BELAKANG 1 (6)"], ["G606","EG06","14486480024","BELAKANG 1 (5)"], ["G602","EG02","14486290951","BELAKANG 1 (5)"], ["G516","DG12","86261269483","BELAKANG 1 (4)"], 
  ["G510","DG10A","86261311426","BELAKANG 1 (4)"], ["G507","DG07A","86261308075","BELAKANG 1 (3)"], ["G503","DG03","86261285778","BELAKANG 1 (3)"], ["G501","DG01","86261311731","BELAKANG 1 (3)"],["G316","CG10","86261311558","DEPAN 4 (6)"], 
  ["G312","CG08B","86261299530","DEPAN 4 (6)"], ["G308","CG06B","86261270218","DEPAN 4 (6)"],
];

export function normalizeToken(x){
  return String(x ?? "").trim().toUpperCase();
}

/**
 * Map utama
 */
export const orderMapRoom = new Map();   // ROOM -> index pertama
export const codeByRoom  = new Map();    // ROOM -> KODE pertama
export const roomByCode  = new Map();    // KODE -> ROOM pertama

export const meterByRoom = new Map();    // ROOM -> NO_METERAN (opsional)
export const meterByCode = new Map();    // KODE -> NO_METERAN (opsional)

export const lokasiAtsByRoom = new Map(); // ROOM -> LOKASI_ATS (opsional)
export const lokasiAtsByCode = new Map(); // KODE -> LOKASI_ATS (opsional)

/**
 * Builder map (AMAN walau ada row undefined / tidak lengkap)
 * Format DENAH boleh:
 * [ROOM, KODE]
 * [ROOM, KODE, NO_METERAN]
 * [ROOM, KODE, NO_METERAN, LOKASI_ATS]
 */
DENAH.forEach((row, idx) => {
  if (!Array.isArray(row)) return;

  const [room, code, meter, lokasiAts] = row;

  const r = normalizeToken(room);
  const c = normalizeToken(code);

  // meter & lokasi ATS opsional
  const m  = (meter && String(meter).trim()) ? String(meter).trim() : "-";
  const la = (lokasiAts && String(lokasiAts).trim()) ? String(lokasiAts).trim() : "-";

  if (!orderMapRoom.has(r)) orderMapRoom.set(r, idx);
  if (!codeByRoom.has(r))  codeByRoom.set(r, c);
  if (!roomByCode.has(c))  roomByCode.set(c, r);

  if (!meterByRoom.has(r)) meterByRoom.set(r, m);
  if (!meterByCode.has(c)) meterByCode.set(c, m);

  if (!lokasiAtsByRoom.has(r)) lokasiAtsByRoom.set(r, la);
  if (!lokasiAtsByCode.has(c)) lokasiAtsByCode.set(c, la);
});

/**
 * Section boundaries (sesuai urutan DENAH kamu)
 * Kamu bisa sesuaikan ukuran section kalau DENAH-mu sudah fix.
 *
 * Catatan: ini contoh boundary lama.
 * Kalau DENAH kamu berubah jumlah item per blok, update angka len.
 */
const SECTIONS = (() => {
  const sizes = [
    ["DEPAN 1", 16],
    ["DEPAN 2", 16],
    ["DEPAN 3", 20],
    ["DEPAN 4", 18],
    ["DEPAN 5", 14],
    ["DEPAN 6", 20],
    ["TENGAH 1", 17],
    ["TENGAH 2", 24],
    ["BELAKANG 1", 17],
    ["BELAKANG 2", 44],
  ];

  let start = 0;
  return sizes.map(([name, len]) => {
    const end = start + len - 1;
    const obj = { name, start, end };
    start = end + 1;
    return obj;
  });
})();

export function getPosisiByIndex(idx){
  if (typeof idx !== "number" || !Number.isFinite(idx)) return "-";
  const s = SECTIONS.find(x => idx >= x.start && idx <= x.end);
  return s ? s.name : "-";
}

/**
 * Posisi detail: "DEPAN 1 ATAS" / "DEPAN 1 BAWAH"
 * Atas = setengah pertama section, Bawah = setengah kedua section.
 */
export function getPosisiDetailByIndex(idx){
  if (typeof idx !== "number" || !Number.isFinite(idx)) return "-";

  const s = SECTIONS.find(x => idx >= x.start && idx <= x.end);
  if (!s) return "-";

  const len = (s.end - s.start + 1);
  const topEnd = s.start + Math.ceil(len / 2) - 1; // setengah pertama = ATAS
  const side = (idx <= topEnd) ? "ATAS" : "BAWAH";

  return `${s.name} ${side}`;
}

export function resolveRoomOrCode(token){
  const t = normalizeToken(token);
  if (!t) return null;

  // input ROOM
  if (orderMapRoom.has(t)) {
    return { room: t, code: codeByRoom.get(t) ?? "-" };
  }

  // input KODE
  if (roomByCode.has(t)) {
    const room = roomByCode.get(t);
    return { room, code: t };
  }

  return { room: t, code: "-", unknown: true };
}

export function sortByDenah(items){
  return [...items].sort((a,b) => (orderMapRoom.get(a.room) ?? 1e18) - (orderMapRoom.get(b.room) ?? 1e18));
}